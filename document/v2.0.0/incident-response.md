# FIT.LOL v2.0.0 Incident Response Runbook

## 공통 원칙
- 누구/무엇/언제: 코릴레이션 ID 기준으로 원인 추적, 타임라인 기록
- 우선 복구, 후 상세 원인 분석(Postmortem 48h 내)
- 유저 영향 줄이기: 읽기 전용/폴백/캐시 활용

---

## 1) 데이터베이스 장애(DB down/lock/풀 고갈)
- **체크**: 에러율/P95 급증, 커넥션 풀 사용률, 슬로우쿼리, 락 대기, 스토리지/IO
- **완화**:
  - 읽기 전용 모드 전환(분석 캐시 제공), 큐 소비 일시중지
  - 트래픽 스로틀, 장기 쿼리 kill, 문제가 된 배치/집계 중단
  - 장애 노드 페일오버 또는 리스타트, 스냅샷/PITR 준비
- **커뮤니케이션**: 상태 페이지 갱신, 예상 복구 시간 공유
- **사후**: 인덱스/쿼리/파티션 검토, 커넥션 풀 설정 조정, 경계 알람 상향

## 2) Riot API 장애/리밋(429/5xx/Timeout)
- **체크**: 429/5xx 비율, Retry-After, 서킷 상태, 큐 적체
- **완화**:
  - 서킷 오픈, 재시도 간격 지터 확대, 최대 시도 하향, DLQ로 격리
  - 스테일 캐시 제공, 사용자 강제 갱신 차단/쿨다운
- **커뮤니케이션**: Riot 상태 모니터 링크 공유, 기능 제한 공지
- **사후**: 호출 우선순위/TTL 재검토, 버짓 기반 호출 상한 설정

## 3) Redis 메모리 압력/큐 폭주
- **체크**: 메모리 사용률, eviction, 큐 pending/failed, 워커 처리시간
- **완화**:
  - 워커 동시성 하향, 큐 투입 제한, 큰 Job 일시 금지
  - 만료키/불필요 캐시 정리, RDB/AOF 튜닝, 스케일아웃
  - DLQ로 이동, 문제 Job 패턴 차단
- **사후**: 키 공간/TTL 정책 점검, dedup 키 설계 개선

## 4) 트래픽 급증(이벤트/봇/오용)
- **체크**: 요청율, 에러율, 상위 엔드포인트, IP/토큰 분포, CDN 캐시 히트율
- **완화**:
  - 레이트리밋 상향/하향 조절, 특정 엔드포인트 스로틀, 캐시 TTL 일시 확장
  - 읽기 전용 모드, 무거운 기능 플래그 오프
  - WAF 룰 강화/IP 차단(임시)
- **사후**: 캐시전략/프리컴퓨트 확대, 최적화/스케일링 계획 업데이트
